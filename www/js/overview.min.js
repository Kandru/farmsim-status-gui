var fields=[],owners=[],ownerColors={},map=null;const fetchData=()=>{fetch(`./livemap.json?timestamp=${(new Date).getTime()}`).then((response=>response.json())).then((data=>{let serverData=data.find((item=>"server"===item.type)),mapName=serverData?serverData.mapName:"Unknown",halfMapSize=(serverData?serverData.mapSize:100)/2;map=L.map("map",{crs:L.CRS.Simple,minZoom:-3,maxBounds:[[-halfMapSize,-halfMapSize],[halfMapSize,halfMapSize]]}).setView([0,0],-3),L.imageOverlay("./images/maps/"+mapName.replace(/ /g,"_")+".jpg",[[-halfMapSize,-halfMapSize],[halfMapSize,halfMapSize]]).addTo(map),(fields=data.filter((item=>"field"===item.type)).map((item=>({type:"Feature",properties:{id:item.farmland,owner:item.farmlandOwner,popup:"Field "+item.farmland+(item.farmlandOwner?` (${item.farmlandOwner})`:"")},geometry:{type:"Polygon",coordinates:item.polygons}})))).forEach((field=>{field.geometry.coordinates[0]=transformCoordinates(field.geometry.coordinates[0])})),owners=[...new Set(fields.map((field=>field.properties.owner)))],ownerColors={},owners.forEach(((owner,index)=>{ownerColors[owner]=generateColor(index)})),ownerColors.null="#808080",L.geoJSON(fields,{style:function(feature){return{color:ownerColors[feature.properties.owner]}}}).addTo(map).eachLayer((function(layer){layer.bindTooltip(layer.feature.properties.popup);const center=layer.getBounds().getCenter();L.marker(center,{icon:L.divIcon({className:"map-marker-field-id",html:layer.feature.properties.id,iconSize:[10,10]})}).addTo(map)}))})).catch((error=>console.error("Error loading fields:",error)))};function transformCoordinates(coords){return coords.map((function(coord){return[coord[0],-coord[1]]}))}function generateColor(index){return`hsl(${137.508*index%360}, 100%, 50%)`}fetchData(),setInterval(fetchData,6e4);